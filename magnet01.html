<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>小小磁鐵科學家</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#4facfe" />
    <link rel="apple-touch-icon" href="icon.svg" />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <meta name="theme-color" content="#4A90E2">
    <link rel="manifest" href="manifest.json">
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(registration => console.log('SW registered'))
            .catch(err => console.log('SW registration failed: ', err));
        });
      }
    </script>
  </head>
  <body>
    <div class="container">
      <!-- Start Screen Overlay -->
      <div id="start-screen" class="overlay">
        <div class="panel start-panel">
          <h1>小小磁鐵科學家</h1>
          <p>探索磁鐵的奧秘，看看什麼東西會被吸起來！</p>
          <div class="mode-selection">
            <button id="btn-normal-mode" class="btn-primary-large">
              自由探索模式
            </button>
            <button id="btn-open-instructions" class="btn-info-large">
              操作說明
            </button>
            <a href="index.html" class="btn-home-large">
              回到主頁
            </a>
          </div>
        </div>
      </div>

      <!-- Instructions Modal (Hidden by default) -->
      <div id="instructions-screen" class="overlay hidden">
        <div class="panel instructions-panel">
          <h2>📖 操作說明</h2>
          <div class="instructions-content">
            <h3>基本操作</h3>
            <ul>
              <li>
                <strong>拖曳物品：</strong
                >從右側工具箱將磁鐵或是其他物品拖曳到工作區上。
              </li>
              <li>
                <strong>觀察現象：</strong
                >移動磁鐵靠近其他物品，看看會發生什麼事情？
              </li>
              <li>
                <strong>旋轉物品：</strong>點擊工作區上的物品可以旋轉它。
              </li>
              <li>
                <strong>刪除物品：</strong
                >對著物品按右鍵（或手機長按）可以刪除。
              </li>
            </ul>

            <h3>小知識</h3>
            <ul>
              <li>
                🧲 <strong>同極相斥，異極相吸：</strong
                >試試看把兩個磁鐵的 N 極靠近看看！
              </li>
            </ul>
          </div>
          <button id="btn-close-instructions" class="btn-primary">關閉</button>
        </div>
      </div>

      <!-- Generic Custom Modal -->
      <div id="generic-modal" class="overlay hidden">
        <div class="panel modal-panel">
           <h2 id="modal-title">標題</h2>
           <p id="modal-message">訊息內容</p>
           <div class="modal-buttons">
             <button id="modal-btn-confirm" class="btn-primary">確定</button>
             <button id="modal-btn-cancel" class="btn-danger hidden">取消</button>
           </div>
        </div>
      </div>

      <header>
        <h1>🧲 小小磁鐵科學家 🧭</h1>
        <p>拖曳磁鐵和物品，觀察它們的互動！</p>
      </header>

      <main>
        <div class="sidebar">
          <h2>工具箱</h2>
          <div class="toolbox">
            <div class="component-item" draggable="true" data-type="bar_magnet">
              <div class="icon">
                <svg width="60" height="30" viewBox="0 0 80 40" style="overflow: visible;">
                  <rect x="10" y="5" width="30" height="30" fill="#ff4757" stroke="#333" stroke-width="2"/>
                  <rect x="40" y="5" width="30" height="30" fill="#3498db" stroke="#333" stroke-width="2"/>
                  <text x="25" y="27" fill="white" font-weight="bold" font-family="Arial" text-anchor="middle" font-size="20">N</text>
                  <text x="55" y="27" fill="white" font-weight="bold" font-family="Arial" text-anchor="middle" font-size="20">S</text>
                </svg>
              </div>
              <span>長條磁鐵</span>
            </div>
            <div class="component-item" draggable="true" data-type="compass">
              <div class="icon">🧭</div>
              <span>指北針</span>
            </div>
            <div class="component-item" draggable="true" data-type="iron_nail">
              <div class="icon">🔩</div>
              <span>鐵釘</span>
            </div>
            <div class="component-item" draggable="true" data-type="coin">
              <div class="icon">🪙</div>
              <span>硬幣(銅)</span>
            </div>
            <div class="component-item" draggable="true" data-type="eraser">
              <div class="icon">🧼</div>
              <span>橡皮擦</span>
            </div>
            <div class="component-item" draggable="true" data-type="key">
              <div class="icon">🗝️</div>
              <span>鑰匙</span>
            </div>
          </div>

          <div class="sidebar-controls">
            <button id="clear-btn" class="btn danger">清除全部</button>
            <button id="home-btn" class="btn home">回到首頁</button>
            <button id="sidebar-instructions-btn" class="btn info">
              操作說明
            </button>
          </div>
        </div>

        <div class="workspace-container">
          <canvas id="magnet-canvas"></canvas>
          <div id="status-display">目前狀態: 自由探索中...</div>

          <!-- Context Menu -->
          <div id="context-menu" class="hidden">
            <div class="menu-item">
                <span id="menu-material-info">材質: 未知</span>
            </div>
            <div
              class="menu-item"
              id="menu-delete"
              style="
                color: #e74c3c;
                cursor: pointer;
                font-weight: bold;
                border-top: 1px solid #eee;
              "
            >
              🗑️ 刪除物品
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="magnet01.js"></script>
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("./sw.js")
          .then(() => console.log("Service Worker Registered"))
          .catch((err) => console.log("SW Failed", err));
      }
    </script>
  </body>
</html>
